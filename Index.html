<script>
    let selectedNode = null, offsetX = 0, offsetY = 0;

    function onPointerDown(e) {
        selectedNode = e.target;
        if (e.type === 'mousedown') {
            offsetX = e.clientX - selectedNode.offsetLeft;
            offsetY = e.clientY - selectedNode.offsetTop;
        } else if (e.type === 'touchstart') {
            offsetX = e.touches[0].clientX - selectedNode.offsetLeft;
            offsetY = e.touches[0].clientY - selectedNode.offsetTop;
        }
    }

    function onPointerMove(e) {
        if (!selectedNode) return;
        e.preventDefault();
        let x = (e.type === 'mousemove') ? e.clientX : e.touches[0].clientX;
        let y = (e.type === 'mousemove') ? e.clientY : e.touches[0].clientY;
        selectedNode.style.left = (x - offsetX) + 'px';
        selectedNode.style.top = (y - offsetY) + 'px';
    }

    function onPointerUp() {
        selectedNode = null;
    }

    document.querySelectorAll('.node').forEach(node => {
        node.addEventListener('mousedown', onPointerDown);
        node.addEventListener('touchstart', onPointerDown);
    });

    document.addEventListener('mousemove', onPointerMove);
    document.addEventListener('touchmove', onPointerMove, { passive: false });
    document.addEventListener('mouseup', onPointerUp);
    document.addEventListener('touchend', onPointerUp);
</script>