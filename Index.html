<script>
    let selectedNode = null;
    let offsetX = 0;
    let offsetY = 0;

    function getPointerEvent(e) {
        return e.touches ? e.touches[0] : e;
    }

    function onPointerDown(e) {
        const pointer = getPointerEvent(e);
        selectedNode = e.target;
        offsetX = pointer.clientX - selectedNode.offsetLeft;
        offsetY = pointer.clientY - selectedNode.offsetTop;
    }

    function onPointerMove(e) {
        if (!selectedNode) return;
        e.preventDefault();
        const pointer = getPointerEvent(e);
        selectedNode.style.left = (pointer.clientX - offsetX) + 'px';
        selectedNode.style.top = (pointer.clientY - offsetY) + 'px';
    }

    function onPointerUp() {
        selectedNode = null;
    }

    document.querySelectorAll('.node').forEach(node => {
        node.addEventListener('mousedown', onPointerDown);
        node.addEventListener('touchstart', onPointerDown, { passive: false });
    });

    document.addEventListener('mousemove', onPointerMove);
    document.addEventListener('touchmove', onPointerMove, { passive: false });
    document.addEventListener('mouseup', onPointerUp);
    document.addEventListener('touchend', onPointerUp);
</script>